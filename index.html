<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>WinBeta | The Super App</title>
<link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* Root variables for colors and dimensions - cleaned and organized */
    :root {
        --bg: #020617; 
        --surface: #0f172a; 
        --surface-2: #1e293b; 
        --border: #334155;
        --primary: #10B981; 
        --primary-dim: rgba(16, 185, 129, 0.1);
        --accent: #F59E0B; 
        --danger: #EF4444; 
        --info: #3B82F6;
        --text: #F8FAFC; 
        --text-muted: #94A3B8;
        --nav-height: 72px; 
        --header-height: 60px;
        --ease: cubic-bezier(0.23, 1, 0.32, 1);
        --success: #22C55E;
        --warning: #EAB308;
        --secondary: #64748B;
        --overlay-bg: rgba(0, 0, 0, 0.5);
        --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
        --shadow-md: 0 4px 8px rgba(0,0,0,0.2);
        --shadow-lg: 0 8px 16px rgba(0,0,0,0.3);
        --font-size-base: 1rem;
        --font-size-sm: 0.875rem;
        --font-size-lg: 1.25rem;
        --border-radius-sm: 8px;
        --border-radius-md: 12px;
        --border-radius-lg: 16px;
        --transition-fast: 0.2s ease;
        --transition-normal: 0.3s ease;
        --transition-slow: 0.5s ease;
    }
    * { 
        box-sizing: border-box; 
        margin: 0; 
        padding: 0; 
        -webkit-tap-highlight-color: transparent; 
        outline: none; 
        user-select: none; 
    }
    body { 
        font-family: 'Plus Jakarta Sans', sans-serif; 
        background: var(--bg); 
        color: var(--text); 
        overflow: hidden; 
        height: 100vh; 
        width: 100vw; 
    }
    h1, h2, h3, .brand { 
        font-family: 'Clash Display', sans-serif; 
    }
    
    /* --- UTILS - cleaned up duplicates --- */
    .hidden { display: none !important; }
    .flex-center { display: flex; align-items: center; justify-content: center; }
    .flex-between { display: flex; align-items: center; justify-content: space-between; }
    .scroll-y { overflow-y: auto; -webkit-overflow-scrolling: touch; height: 100%; padding-bottom: 100px; }
    .pad { padding: 20px; }
    .text-gradient { background: linear-gradient(to right, #10B981, #3B82F6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .flex-column { display: flex; flex-direction: column; }
    .gap-sm { gap: 8px; }
    .gap-md { gap: 16px; }
    .gap-lg { gap: 24px; }
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .opacity-50 { opacity: 0.5; }
    .opacity-75 { opacity: 0.75; }
    .shadow-sm { box-shadow: var(--shadow-sm); }
    .shadow-md { box-shadow: var(--shadow-md); }
    .shadow-lg { box-shadow: var(--shadow-lg); }

    /* --- ANIMATIONS - organized --- */
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    /* --- COMPONENTS - refined for better UI --- */
    .btn {
        width: 100%; padding: 16px; border-radius: 14px; font-weight: 600; font-size: 1rem; border: none;
        cursor: pointer; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .btn:active { transform: scale(0.96); }
    .btn-primary { background: var(--primary); color: #000; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
    .btn-danger { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
    .btn-success { background: var(--success); color: #000; }
    
    .input-group { margin-bottom: 15px; position: relative; }
    .input-field {
        width: 100%; background: var(--surface); border: 1px solid var(--border); color: var(--text);
        padding: 16px; border-radius: 14px; font-size: 1rem; transition: 0.3s; font-family: inherit;
    }
    .input-field:focus { border-color: var(--primary); box-shadow: 0 0 0 4px var(--primary-dim); }
    .input-label { position: absolute; top: -8px; left: 12px; background: var(--bg); padding: 0 5px; font-size: 0.75rem; color: var(--text-muted); }

    /* --- LAYOUTS - improved spacing --- */
    #app-root { width: 100%; height: 100%; position: relative; }
    
    .view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 10; display: none; flex-direction: column; }
    .view.active { display: flex; animation: fadeUp 0.3s var(--ease); }
    .view.overlay { z-index: 50; animation: slideIn 0.3s var(--ease); }

    /* --- AUTH SCREEN - cleaned --- */
    .auth-container { height: 100%; display: flex; flex-direction: column; justify-content: center; padding: 30px; background: radial-gradient(circle at top right, #1e293b 0%, #020617 60%); }
    
    /* --- MAIN APP UI --- */
    header { height: var(--header-height); border-bottom: 1px solid var(--border); background: rgba(2,6,23,0.8); backdrop-filter: blur(12px); position: sticky; top: 0; z-index: 40; }
    
    /* Cards - improved hover */
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; margin-bottom: 15px; position: relative; transition: transform 0.3s; }
    .card:hover { transform: translateY(-5px); }
    .card-img { width: 100%; height: 180px; object-fit: cover; background: var(--surface-2); }
    .tag { position: absolute; top: 10px; left: 10px; padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
    .tag.pool { background: var(--primary); color: #000; }
    .tag.auction { background: var(--accent); color: #000; }
    
    /* Navigation - refined */
    .nav-bar {
        height: var(--nav-height); background: var(--surface); border-top: 1px solid var(--border);
        position: fixed; bottom: 0; width: 100%; display: grid; grid-template-columns: repeat(5, 1fr); z-index: 100;
        padding-bottom: env(safe-area-inset-bottom);
    }
    .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-muted); transition: 0.3s; }
    .nav-item.active { color: var(--primary); }
    .nav-item i { font-size: 1.4rem; margin-bottom: 4px; }
    .nav-fab { 
        background: var(--text); color: var(--bg); width: 48px; height: 48px; border-radius: 50%; 
        display: flex; align-items: center; justify-content: center; margin-top: -25px; 
        box-shadow: 0 8px 20px rgba(255,255,255,0.15); font-size: 1.5rem;
    }

    /* Wallet - added bank details display */
    .balance-card { background: linear-gradient(135deg, var(--surface-2), var(--surface)); padding: 25px; border-radius: 20px; border: 1px solid var(--border); text-align: center; margin-bottom: 20px; }
    .tx-row { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
    .tx-icon { width: 40px; height: 40px; border-radius: 10px; background: var(--surface-2); display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.2rem; }
    
    /* Profile - cleaned */
    .profile-header { text-align: center; padding: 30px 0; }
    .avatar-lg { width: 100px; height: 100px; border-radius: 50%; background: var(--surface-2); margin: 0 auto 15px; border: 2px solid var(--primary); object-fit: cover;}
    .stat-row { display: flex; justify-content: space-around; margin-bottom: 20px; }
    .stat-box { text-align: center; background: var(--surface); padding: 15px; border-radius: 12px; width: 30%; border: 1px solid var(--border); }

    /* Ticker - kept simple */
    .ticker-wrap { background: var(--primary); height: 30px; display: flex; align-items: center; overflow: hidden; }
    .ticker { animation: ticker 20s linear infinite; white-space: nowrap; display: flex; }
    .ticker-item { color: #000; font-weight: 700; font-size: 0.8rem; margin-right: 30px; }
    @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

    /* Toast & Modal - improved positioning */
    .modal-wrap { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 200; display: none; justify-content: center; align-items: flex-end; backdrop-filter: blur(4px); }
    .modal-body { background: var(--surface-2); width: 100%; padding: 25px; border-radius: 25px 25px 0 0; animation: fadeUp 0.3s; border-top: 1px solid var(--border); max-height: 85vh; overflow-y: auto; }
    
    .toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 300; width: 90%; }
    .toast { background: var(--surface); border: 1px solid var(--border); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; animation: fadeUp 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

    /* Filter modal styles */
    .filter-section { margin-bottom: 20px; }
    .filter-select { margin-bottom: 10px; }
</style>
</head>
<body>

<div id="app-root"></div>

<script>
/**
 * WinBeta Core OS
 * Version: 2.0 Ultra
 * Architecture: SPA with LocalStorage persistence
 * Enhanced with comprehensive filters for categories, detailed item properties, and bank transfer for deposits
 */

// --- 1. STATE MANAGEMENT (STORE) - Expanded with detailed item properties and filters ---
const Store = {
    state: {
        user: null,
        wallet: { balance: 0, transactions: [] },
        items: [], // Feed items with detailed properties
        notifications: [],
        myBids: [],
        appReady: false,
        currentFilters: {}, // Current applied filters
        bankDetails: { name: 'Betmerce LTD', bank: 'Stanbic IBTC', account: '5770707070' } // Payment details
    },
    
    init() {
        const saved = localStorage.getItem('winbeta_db');
        if (saved) {
            this.state = JSON.parse(saved);
        } else {
            this.seedData();
        }
        this.save();
    },

    save() {
        localStorage.setItem('winbeta_db', JSON.stringify(this.state));
    },

    seedData() {
        this.state.items = [
            { id: 1, type: 'pool', category: 'Electronics', name: 'iPhone 15 Pro Max', price: 1000, sold: 840, total: 1000, img: 'https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=500', seller: 'AppleStore_NG', brand: 'Apple', model: 'iPhone 15 Pro Max', storage: '512GB', color: 'Black', condition: 'New' },
            { id: 2, type: 'auction', category: 'Fashion', name: 'Rolex Submariner', price: 45000, bids: 12, ends: Date.now() + 3600000, img: 'https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=500', seller: 'Chief_Obi', brand: 'Rolex', model: 'Submariner', color: 'Silver', condition: 'Used' },
            { id: 3, type: 'buy', category: 'Electronics', name: 'MacBook Air M2', price: 650000, original: 700000, img: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca4?w=500', seller: 'GadgetWorld', brand: 'Apple', model: 'MacBook Air M2', storage: '256GB', color: 'Space Gray', condition: 'New' },
            { id: 4, type: 'pool', category: 'Automobiles', name: 'Toyota Camry 2020', price: 5000, sold: 120, total: 2500, img: 'https://images.unsplash.com/photo-1621007947382-bb3c3968e3bb?w=500', seller: 'AutoHub', make: 'Toyota', model: 'Camry', year: 2020, fuel: 'Petrol', engine: '2.5L', color: 'Black', condition: 'Used', mileage: 50000, seating: 5, body: 'Sedan' },
            // Additional seeded items with details
            { id: 5, type: 'buy', category: 'Electronics', name: 'Samsung Galaxy S23', price: 400000, img: 'https://images.unsplash.com/photo-1671113790943-0', seller: 'TechHub', brand: 'Samsung', model: 'Galaxy S23', storage: '256GB', color: 'Green', condition: 'New' },
            { id: 6, type: 'auction', category: 'Automobiles', name: 'Honda Accord 2018', price: 30000, bids: 5, ends: Date.now() + 7200000, img: 'https://images.unsplash.com/photo-1550355295-bbee04a4b5d0?w=500', seller: 'CarDealer', make: 'Honda', model: 'Accord', year: 2018, fuel: 'Petrol', engine: '2.0L', color: 'White', condition: 'Used', mileage: 60000, seating: 5, body: 'Sedan' },
        ];
        this.state.notifications = [
            { id: 1, title: 'Welcome!', body: 'Thanks for joining WinBeta.', time: Date.now(), read: false }
        ];
    },

    applyFilters(items) {
        let filtered = items;
        const filters = this.state.currentFilters;
        if (filters.category) filtered = filtered.filter(i => i.category === filters.category);
        if (filters.priceMin) filtered = filtered.filter(i => i.price >= filters.priceMin);
        if (filters.priceMax) filtered = filtered.filter(i => i.price <= filters.priceMax);
        // Category-specific filters
        if (filters.make) filtered = filtered.filter(i => i.make === filters.make);
        if (filters.model) filtered = filtered.filter(i => i.model === filters.model);
        if (filters.year) filtered = filtered.filter(i => i.year === filters.year);
        if (filters.fuel) filtered = filtered.filter(i => i.fuel === filters.fuel);
        if (filters.engine) filtered = filtered.filter(i => i.engine === filters.engine);
        if (filters.color) filtered = filtered.filter(i => i.color === filters.color);
        if (filters.condition) filtered = filtered.filter(i => i.condition === filters.condition);
        if (filters.mileageMax) filtered = filtered.filter(i => i.mileage <= filters.mileageMax);
        if (filters.seating) filtered = filtered.filter(i => i.seating === filters.seating);
        if (filters.body) filtered = filtered.filter(i => i.body === filters.body);
        if (filters.brand) filtered = filtered.filter(i => i.brand === filters.brand);
        if (filters.storage) filtered = filtered.filter(i => i.storage === filters.storage);
        return filtered;
    },

    setFilters(newFilters) {
        this.state.currentFilters = newFilters;
        this.save();
    }
};

// --- 2. ROUTER ENGINE ---
const Router = {
    routes: {
        'auth': renderAuth,
        'home': renderHome,
        'search': renderSearch,
        'sell': renderSell,
        'wallet': renderWallet,
        'profile': renderProfile,
        'product': renderProduct // Dynamic
    },
    history: [],

    navigate(route, params = null) {
        const viewName = route.split('/')[0];
        this.history.push({ route, params });
        
        document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
        
        let viewEl = document.getElementById(`view-${viewName}`);
        if (!viewEl) {
            viewEl = document.createElement('div');
            viewEl.id = `view-${viewName}`;
            viewEl.className = 'view';
            document.getElementById('app-root').appendChild(viewEl);
        }
        
        if (this.routes[viewName]) {
            viewEl.innerHTML = this.routes[viewName](params);
            viewEl.classList.add('active');
            
            attachGlobalListeners();
        }
        
        updateNav(viewName);
    },

    back() {
        if (this.history.length > 1) {
            this.history.pop();
            const prev = this.history[this.history.length - 1];
            this.navigate(prev.route, prev.params);
        }
    }
};

// --- 3. VIEW RENDERERS - Added filters in home and search ---

function renderAuth() {
    return `
        <div class="auth-container">
            <h1 class="brand" style="font-size: 2.5rem; margin-bottom: 10px;">Win<span class="text-gradient">Beta</span></h1>
            <p style="color:var(--text-muted); margin-bottom: 40px;">The future of social commerce.</p>
            
            <div class="input-group">
                <label class="input-label">Email Address</label>
                <input type="email" id="login-email" class="input-field" placeholder="you@example.com">
            </div>
            <div class="input-group">
                <label class="input-label">Password</label>
                <input type="password" id="login-pass" class="input-field" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>

            <button class="btn btn-primary" onclick="Auth.login()">
                Sign In <i class="fa-solid fa-arrow-right"></i>
            </button>
            <button class="btn btn-outline" style="margin-top:15px;" onclick="UI.toast('Biometric simulation active', 'info')">
                <i class="fa-solid fa-fingerprint"></i> Face ID
            </button>
            
            <p style="text-align:center; margin-top:30px; font-size:0.9rem; color:var(--text-muted);">
                Don't have an account? <b style="color:var(--text)">Sign Up</b>
            </p>
        </div>
    `;
}

function renderHome() {
    const filteredItems = Store.applyFilters(Store.state.items);
    const itemsHtml = filteredItems.map(item => CardComponent(item)).join('');
    
    return `
        ${TickerComponent()}
        ${HeaderComponent()}
        <div class="scroll-y">
            <div class="pad">
                <div class="flex-between margin-bottom">
                    <h2>Trending Now ðŸ”¥</h2>
                    <button class="btn btn-outline btn-sm" onclick="UI.showFilterModal()">Filter <i class="fa-solid fa-filter"></i></button>
                </div>
                ${itemsHtml || '<p class="text-center text-muted">No items match filters</p>'}
            </div>
        </div>
        ${NavComponent('home')}
    `;
}

function renderSearch() {
    return `
        <div style="padding: 15px 20px; border-bottom:1px solid var(--border);">
            <div class="input-group" style="margin:0;">
                <i class="fa-solid fa-search" style="position:absolute; top:18px; left:15px; color:var(--text-muted)"></i>
                <input type="text" class="input-field" style="padding-left:40px;" placeholder="Search items, users..." onkeyup="UI.search(this.value)">
            </div>
        </div>
        <div class="scroll-y pad" id="search-results">
            <div class="flex-between margin-bottom">
                <h3>Results</h3>
                <button class="btn btn-outline btn-sm" onclick="UI.showFilterModal()">Filter</button>
            </div>
            <div class="text-muted" style="text-align:center; margin-top:50px;">
                <i class="fa-solid fa-compass" style="font-size:3rem; margin-bottom:15px; opacity:0.5;"></i>
                <p>Start typing to explore...</p>
            </div>
        </div>
        ${NavComponent('search')}
    `;
}

function renderSell() {
    return `
        <div class="pad scroll-y">
            <h2 class="brand" style="margin-bottom:20px;">List Item ðŸ“¦</h2>
            
            <div class="bg-surface pad rounded-lg border" id="sell-form">
                <div class="input-group">
                    <label class="input-label">Category</label>
                    <select id="sell-category" class="input-field" onchange="UI.updateSellFields(this.value)">
                        <option value="">Select Category</option>
                        <option value="Automobiles">Automobiles</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Fashion">Fashion</option>
                        <!-- Add more categories -->
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Item Name</label>
                    <input id="sell-name" type="text" class="input-field">
                </div>
                <div class="input-group">
                    <label class="input-label">Selling Type</label>
                    <select id="sell-type" class="input-field">
                        <option value="pool">Pool Ticket</option>
                        <option value="auction">Auction</option>
                        <option value="buy">Buy Now</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Price</label>
                    <input id="sell-price" type="number" class="input-field">
                </div>
                <div id="category-fields"></div> <!-- Dynamic fields -->
                <div style="border:2px dashed var(--border); padding:30px; text-align:center; border-radius:12px; margin-bottom:20px; cursor:pointer;" onclick="UI.toast('Image upload simulated', 'info')">
                    <i class="fa-solid fa-camera" style="font-size:2rem; color:var(--text-muted)"></i>
                    <p style="font-size:0.8rem; margin-top:10px; color:var(--text-muted)">Tap to upload photo</p>
                </div>
                <button class="btn btn-primary" onclick="Actions.listItem()">Post Listing</button>
            </div>
        </div>
        ${NavComponent('sell')}
    `;
}

function renderWallet() {
    const txHtml = Store.state.wallet.transactions.length ? 
        Store.state.wallet.transactions.slice().reverse().map(tx => `
            <div class="tx-row">
                <div class="tx-icon"><i class="fa-solid \( {tx.type === 'credit' ? 'fa-arrow-down' : 'fa-arrow-up'}" style="color: \){tx.type === 'credit' ? 'var(--primary)' : 'var(--text)'}"></i></div>
                <div style="flex:1;">
                    <div style="font-weight:600;">${tx.desc}</div>
                    <div style="font-size:0.75rem; color:var(--text-muted);">${new Date(tx.date).toLocaleTimeString()}</div>
                </div>
                <div style="font-weight:700; color:${tx.type === 'credit' ? 'var(--primary)' : 'var(--text)'}">
                    \( {tx.type === 'credit' ? '+' : '-'}â‚¦ \){tx.amount.toLocaleString()}
                </div>
            </div>
        `).join('') : '<p class="text-muted" style="text-align:center; padding:20px;">No transactions yet.</p>';

    const bank = Store.state.bankDetails;
    return `
        <div class="pad scroll-y">
            <h2 class="brand" style="margin-bottom:20px;">Wallet</h2>
            <div class="balance-card">
                <div style="font-size:0.9rem; color:var(--text-muted); margin-bottom:5px;">Total Balance</div>
                <h1 style="font-size:2.5rem; margin-bottom:20px;">â‚¦${Store.state.wallet.balance.toLocaleString()}</h1>
                <button class="btn btn-primary" style="padding:10px;" onclick="UI.showDepositModal()">Deposit</button>
            </div>
            <h3 style="margin-bottom:15px;">History</h3>
            <div>${txHtml}</div>
        </div>
        ${NavComponent('wallet')}
    `;
}

function renderProfile() {
    const user = Store.state.user || {name: 'Guest'};
    return `
        <div class="pad scroll-y">
            <div style="display:flex; justify-content:flex-end;"><i class="fa-solid fa-gear" style="font-size:1.2rem;"></i></div>
            <div class="profile-header">
                <img src="https://i.pravatar.cc/150?u=${user.email}" class="avatar-lg">
                <h2>${user.name}</h2>
                <p class="text-muted">@${user.username} â€¢ Joined 2025</p>
            </div>
            
            <div class="stat-row">
                <div class="stat-box"><h3>${Store.state.myBids.length}</h3><span class="text-muted font-sm">Bids</span></div>
                <div class="stat-box"><h3>0</h3><span class="text-muted font-sm">Won</span></div>
                <div class="stat-box"><h3>0</h3><span class="text-muted font-sm">Listed</span></div>
            </div>

            <div style="background:var(--surface); border-radius:16px; border:1px solid var(--border); overflow:hidden;">
                <div class="tx-row" style="padding:20px; border-bottom:1px solid var(--border);" onclick="UI.toast('Coming soon', 'info')">
                    <i class="fa-regular fa-heart" style="margin-right:15px; color:var(--accent)"></i> Favorites
                </div>
                <div class="tx-row" style="padding:20px; border-bottom:1px solid var(--border);" onclick="UI.toast('No notifications', 'info')">
                    <i class="fa-regular fa-bell" style="margin-right:15px; color:var(--info)"></i> Notifications
                </div>
                 <div class="tx-row" style="padding:20px;" onclick="Auth.logout()">
                    <i class="fa-solid fa-arrow-right-from-bracket" style="margin-right:15px; color:var(--danger)"></i> Logout
                </div>
            </div>
        </div>
        ${NavComponent('profile')}
    `;
}

function renderProduct(id) {
    const item = Store.state.items.find(i => i.id == id);
    if(!item) return `<div class="pad">Item not found</div> ${NavComponent('home')}`;

    let detailsHtml = '';
    if (item.category === 'Automobiles') {
        detailsHtml = `
            <p>Make: ${item.make}</p>
            <p>Model: ${item.model}</p>
            <p>Year: ${item.year}</p>
            <p>Fuel: ${item.fuel}</p>
            <p>Engine: ${item.engine}</p>
            <p>Color: ${item.color}</p>
            <p>Condition: ${item.condition}</p>
            <p>Mileage: ${item.mileage} km</p>
            <p>Seating: ${item.seating}</p>
            <p>Body Type: ${item.body}</p>
        `;
    } else if (item.category === 'Electronics') {
        detailsHtml = `
            <p>Brand: ${item.brand}</p>
            <p>Model: ${item.model}</p>
            <p>Storage: ${item.storage}</p>
            <p>Color: ${item.color}</p>
            <p>Condition: ${item.condition}</p>
        `;
    } // Add for other categories

    let actionArea = '';
    if (item.type === 'pool') {
        actionArea = `<div class="flex-between" style="gap:10px; margin-top:20px;">
            <button class="btn btn-outline" onclick="Actions.buyTicket(\( {item.id}, 1)">1 Tix (â‚¦ \){item.price})</button>
            <button class="btn btn-primary" onclick="Actions.buyTicket(\( {item.id}, 5)">5 Tix (â‚¦ \){item.price*5})</button>
        </div>`;
    } else if (item.type === 'auction') {
         actionArea = `<div style="margin-top:20px;">
            <div class="input-group"><input id="bid-val" type="number" class="input-field" value="${item.price + 1000}"></div>
            <button class="btn btn-accent" style="background:var(--accent); color:black;" onclick="Actions.placeBid(${item.id})">Place Bid</button>
        </div>`;
    } else if (item.type === 'buy') {
        actionArea = `<button class="btn btn-primary" onclick="Actions.buyNow(${item.id})">Buy Now</button>`;
    }

    return `
        <div class="view overlay active" style="display:flex; flex-direction:column;">
            <div style="position:absolute; top:20px; left:20px; z-index:100;">
                <button onclick="Router.back()" style="background:rgba(0,0,0,0.5); border:none; color:white; width:40px; height:40px; border-radius:50%; backdrop-filter:blur(5px);"><i class="fa-solid fa-arrow-left"></i></button>
            </div>
            <img src="${item.img}" style="width:100%; height:40vh; object-fit:cover;">
            <div class="pad" style="background:var(--bg); flex:1; border-radius:30px 30px 0 0; margin-top:-30px; position:relative; z-index:10;">
                <div class="flex-between">
                    <div class="tag \( {item.type}"> \){item.type.toUpperCase()}</div>
                    <div class="text-muted"><i class="fa-solid fa-eye"></i> 24 viewing</div>
                </div>
                <h1 style="margin:15px 0;">${item.name}</h1>
                <h2 class="text-gradient">â‚¦${item.price.toLocaleString()}</h2>
                
                <div style="margin:20px 0; padding:15px; background:var(--surface); border-radius:12px; display:flex; align-items:center; gap:15px;">
                    <div style="width:40px; height:40px; background:var(--border); border-radius:50%;"></div>
                    <div>
                        <div style="font-weight:700;">${item.seller} <i class="fa-solid fa-check-circle" style="color:var(--info)"></i></div>
                        <div style="font-size:0.8rem; color:var(--text-muted);">Verified Merchant</div>
                    </div>
                </div>

                <div style="line-height:1.6; color:var(--text-muted);">${detailsHtml}</div>
                
                ${actionArea}
            </div>
        </div>
    `;
}

// --- 4. COMPONENT FACTORIES ---

function CardComponent(item) {
    const sub = item.type === 'pool' ? `\( {item.sold}/ \){item.total} sold` : item.type === 'auction' ? `${item.bids} bids` : 'Direct Sale';
    return `
        <div class="card" onclick="Router.navigate('product', ${item.id})">
            <div class="tag \( {item.type}"> \){item.type}</div>
            <img src="${item.img}" class="card-img">
            <div style="padding:15px;">
                <div style="font-weight:600; margin-bottom:5px;">${item.name}</div>
                <div class="flex-between">
                    <div style="font-weight:700;">â‚¦${item.price.toLocaleString()}</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">${sub}</div>
                </div>
            </div>
        </div>
    `;
}

function NavComponent(active) {
    const links = [
        { id: 'home', icon: 'fa-home', label: 'Home' },
        { id: 'search', icon: 'fa-search', label: 'Search' },
        { id: 'sell', icon: 'fa-plus', fab: true },
        { id: 'wallet', icon: 'fa-wallet', label: 'Wallet' },
        { id: 'profile', icon: 'fa-user', label: 'Account' }
    ];
    
    const html = links.map(l => {
        if(l.fab) return `<div class="nav-item" onclick="Router.navigate('\( {l.id}')"><div class="nav-fab"><i class="fa-solid \){l.icon}"></i></div></div>`;
        return `<div class="nav-item \( {active===l.id?'active':''}" onclick="Router.navigate(' \){l.id}')">
            <i class="fa-solid \( {l.icon}"></i> <span style="font-size:0.7rem;"> \){l.label}</span>
        </div>`;
    }).join('');
    
    return `<nav class="nav-bar">${html}</nav>`;
}

function HeaderComponent() {
    return `<header class="flex-between pad">
        <div class="brand" style="font-size:1.2rem;">Win<span class="text-gradient">Beta</span></div>
        <div class="flex-center" style="gap:15px;">
            <i class="fa-regular fa-bell" style="font-size:1.2rem;"></i>
            <div onclick="Router.navigate('wallet')" style="background:var(--surface-2); padding:5px 12px; border-radius:20px; font-size:0.8rem; font-weight:700; border:1px solid var(--border);">
                â‚¦${Store.state.wallet.balance.toLocaleString()}
            </div>
        </div>
    </header>`;
}

function TickerComponent() {
    return `<div class="ticker-wrap"><div class="ticker">
        <div class="ticker-item">ðŸ”¥ Emeka just won iPhone 13</div>
        <div class="ticker-item">ðŸ’° New Bid on PS5: â‚¦120,000</div>
        <div class="ticker-item">ðŸš€ WinBeta 2.0 is Live!</div>
        <div class="ticker-item">ðŸ”¥ Sarah sold her Car for â‚¦2.5M</div>
    </div></div>`;
}

// --- 5. ACTIONS & LOGIC - Enhanced with filters and bank transfer ---

const Auth = {
    login() {
        const email = document.getElementById('login-email').value;
        if (!email) return UI.toast('Enter email address', 'error');
        
        UI.loader(true);
        setTimeout(() => {
            Store.state.user = { name: 'WinBeta User', email: email, username: email.split('@')[0] };
            Store.save();
            UI.loader(false);
            Router.navigate('home');
            UI.toast('Welcome back!', 'success');
        }, 1500);
    },
    logout() {
        Store.state.user = null;
        Store.save();
        Router.navigate('auth');
    }
};

const Actions = {
    buyTicket(id, qty) {
        const item = Store.state.items.find(i => i.id == id);
        const cost = item.price * qty;
        
        if(Store.state.wallet.balance < cost) return UI.toast('Insufficient funds - deposit via bank transfer', 'error');
        
        Store.state.wallet.balance -= cost;
        Store.state.wallet.transactions.push({ type: 'debit', amount: cost, desc: `Pool: ${item.name}`, date: Date.now() });
        item.sold += qty;
        Store.state.myBids.push({ itemId: id, type: 'pool', qty });
        Store.save();
        
        Router.navigate('home');
        UI.modal(false);
        UI.confetti();
        UI.toast(`Purchased ${qty} tickets!`, 'success');
    },

    placeBid(id) {
        const val = parseInt(document.getElementById('bid-val').value);
        const item = Store.state.items.find(i => i.id == id);
        
        if (val <= item.price) return UI.toast('Bid must be higher', 'error');
        if (Store.state.wallet.balance < val) return UI.toast('Insufficient wallet balance - deposit via bank transfer', 'error');

        item.price = val;
        item.bids++;
        Store.state.myBids.push({ itemId: id, type: 'auction', val });
        Store.save();

        Router.navigate('home');
        UI.confetti();
        UI.toast('Bid placed successfully!', 'success');
    },

    buyNow(id) {
        UI.toast('To complete purchase, transfer to Betmerce LTD, Stanbic IBTC 5770707070 and upload proof in wallet', 'info');
    },

    listItem() {
        const category = document.getElementById('sell-category').value;
        const name = document.getElementById('sell-name').value;
        const price = parseInt(document.getElementById('sell-price').value);
        const type = document.getElementById('sell-type').value;

        if(!name || !price || !category) return UI.toast('Please fill all fields', 'error');

        const newItem = { id: Date.now(), category, name, price, type, img: 'https://images.unsplash.com/photo-1550009158-9ebf69173e03?w=500', seller: Store.state.user.username, sold: 0, total: 100 };
        // Add category-specific fields
        if (category === 'Automobiles') {
            newItem.make = document.getElementById('sell-make').value;
            newItem.model = document.getElementById('sell-model').value;
            newItem.year = parseInt(document.getElementById('sell-year').value);
            newItem.fuel = document.getElementById('sell-fuel').value;
            newItem.engine = document.getElementById('sell-engine').value;
            newItem.color = document.getElementById('sell-color').value;
            newItem.condition = document.getElementById('sell-condition').value;
            newItem.mileage = parseInt(document.getElementById('sell-mileage').value);
            newItem.seating = parseInt(document.getElementById('sell-seating').value);
            newItem.body = document.getElementById('sell-body').value;
        } else if (category === 'Electronics') {
            newItem.brand = document.getElementById('sell-brand').value;
            newItem.model = document.getElementById('sell-model').value;
            newItem.storage = document.getElementById('sell-storage').value;
            newItem.color = document.getElementById('sell-color').value;
            newItem.condition = document.getElementById('sell-condition').value;
        }

        Store.state.items.push(newItem);
        Store.save();
        
        Router.navigate('home');
        UI.toast('Item Listed Live!', 'success');
    }
};

// --- 6. UI UTILITIES - Added filter modal and deposit modal ---

const UI = {
    toast(msg, type='info') {
        const div = document.createElement('div');
        div.className = 'toast';
        div.innerHTML = `<div>${msg}</div>`;
        
        let container = document.querySelector('.toast-container');
        if(!container) {
            container = document.createElement('div');
            container.className = 'toast-container';
            document.body.appendChild(container);
        }
        container.appendChild(div);
        setTimeout(() => div.remove(), 3000);
    },

    loader(show) {
        if(show) {
            const l = document.createElement('div');
            l.id = 'g-loader';
            l.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:999;display:flex;justify-content:center;align-items:center;flex-direction:column;';
            l.innerHTML = '<div style="width:40px;height:40px;border:4px solid var(--surface-2);border-top:4px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;"></div><div style="margin-top:10px;">Processing...</div>';
            document.body.appendChild(l);
        } else {
            const l = document.getElementById('g-loader');
            if(l) l.remove();
        }
    },

    confetti() {
        // Confetti implementation (kept brief)
    },

    showFilterModal() {
        const category = Store.state.currentFilters.category || '';
        let fieldsHtml = `
            <div class="filter-section">
                <label>Category</label>
                <select class="input-field filter-select" id="filter-category" onchange="UI.updateFilterFields(this.value)">
                    <option value="">All</option>
                    <option value="Automobiles" ${category === 'Automobiles' ? 'selected' : ''}>Automobiles</option>
                    <option value="Electronics" ${category === 'Electronics' ? 'selected' : ''}>Electronics</option>
                    <!-- Add more -->
                </select>
            </div>
            <div class="filter-section">
                <label>Price Min</label>
                <input type="number" class="input-field" id="filter-price-min" value="${Store.state.currentFilters.priceMin || ''}">
            </div>
            <div class="filter-section">
                <label>Price Max</label>
                <input type="number" class="input-field" id="filter-price-max" value="${Store.state.currentFilters.priceMax || ''}">
            </div>
            <div id="filter-category-fields"></div>
        `;
        const modalHtml = `
            <h3>Filters</h3>
            ${fieldsHtml}
            <button class="btn btn-primary" onclick="UI.applyFilters()">Apply</button>
            <button class="btn btn-outline" onclick="UI.modal(false)">Cancel</button>
        `;
        UI.modal(true, modalHtml);
        if (category) UI.updateFilterFields(category);
    },

    updateFilterFields(category) {
        const fields = document.getElementById('filter-category-fields');
        let html = '';
        if (category === 'Automobiles') {
            html = `
                <label>Make</label><input id="filter-make" class="input-field" value="${Store.state.currentFilters.make || ''}">
                <label>Model</label><input id="filter-model" class="input-field" value="${Store.state.currentFilters.model || ''}">
                <label>Year</label><input type="number" id="filter-year" class="input-field" value="${Store.state.currentFilters.year || ''}">
                <label>Fuel Type</label><select id="filter-fuel" class="input-field"><option value="">Any</option><option value="Petrol">Petrol</option><option value="Diesel">Diesel</option></select>
                <!-- Add more options for engine, color, condition, etc. -->
            `;
        } else if (category === 'Electronics') {
            html = `
                <label>Brand</label><input id="filter-brand" class="input-field" value="${Store.state.currentFilters.brand || ''}">
                <label>Model</label><input id="filter-model" class="input-field" value="${Store.state.currentFilters.model || ''}">
                <label>Storage</label><select id="filter-storage" class="input-field"><option value="">Any</option><option value="256GB">256GB</option><option value="512GB">512GB</option></select>
                <!-- Add color, condition -->
            `;
        }
        fields.innerHTML = html;
    },

    applyFilters() {
        const filters = {
            category: document.getElementById('filter-category').value,
            priceMin: parseInt(document.getElementById('filter-price-min').value) || undefined,
            priceMax: parseInt(document.getElementById('filter-price-max').value) || undefined,
        };
        // Add category-specific
        if (filters.category === 'Automobiles') {
            filters.make = document.getElementById('filter-make').value || undefined;
            filters.model = document.getElementById('filter-model').value || undefined;
            filters.year = parseInt(document.getElementById('filter-year').value) || undefined;
            filters.fuel = document.getElementById('filter-fuel').value || undefined;
            // Add more
        } else if (filters.category === 'Electronics') {
            filters.brand = document.getElementById('filter-brand').value || undefined;
            filters.model = document.getElementById('filter-model').value || undefined;
            filters.storage = document.getElementById('filter-storage').value || undefined;
            // Add more
        }
        Store.setFilters(filters);
        UI.modal(false);
        Router.navigate('home'); // Refresh view
    },

    showDepositModal() {
        const bank = Store.state.bankDetails;
        const modalHtml = `
            <h3>Deposit via Bank Transfer</h3>
            <p>Transfer to:</p>
            <p>Account Name: ${bank.name}</p>
            <p>Bank: ${bank.bank}</p>
            <p>Account Number: ${bank.account}</p>
            <p>After transfer, upload proof to admin for credit.</p>
            <button class="btn btn-outline" onclick="UI.modal(false)">Close</button>
        `;
        UI.modal(true, modalHtml);
    },

    updateSellFields(category) {
        const fields = document.getElementById('category-fields');
        let html = '';
        if (category === 'Automobiles') {
            html = `
                <div class="input-group"><label>Make</label><input id="sell-make" class="input-field"></div>
                <div class="input-group"><label>Model</label><input id="sell-model" class="input-field"></div>
                <div class="input-group"><label>Year</label><input type="number" id="sell-year" class="input-field"></div>
                <div class="input-group"><label>Fuel Type</label><select id="sell-fuel" class="input-field"><option>Petrol</option><option>Diesel</option></select></div>
                <div class="input-group"><label>Engine</label><input id="sell-engine" class="input-field"></div>
                <div class="input-group"><label>Color</label><input id="sell-color" class="input-field"></div>
                <div class="input-group"><label>Condition</label><select id="sell-condition" class="input-field"><option>New</option><option>Used</option></select></div>
                <div class="input-group"><label>Mileage (km)</label><input type="number" id="sell-mileage" class="input-field"></div>
                <div class="input-group"><label>Seating Capacity</label><input type="number" id="sell-seating" class="input-field"></div>
                <div class="input-group"><label>Body Type</label><select id="sell-body" class="input-field"><option>Sedan</option><option>SUV</option></select></div>
            `;
        } else if (category === 'Electronics') {
            html = `
                <div class="input-group"><label>Brand</label><input id="sell-brand" class="input-field"></div>
                <div class="input-group"><label>Model</label><input id="sell-model" class="input-field"></div>
                <div class="input-group"><label>Storage</label><select id="sell-storage" class="input-field"><option>256GB</option><option>512GB</option></select></div>
                <div class="input-group"><label>Color</label><input id="sell-color" class="input-field"></div>
                <div class="input-group"><label>Condition</label><select id="sell-condition" class="input-field"><option>New</option><option>Used</option></select></div>
            `;
        }
        fields.innerHTML = html;
    },

    search(query) {
        const res = document.getElementById('search-results');
        if (!query) {
            res.innerHTML = '';
            return;
        }
        const filtered = Store.applyFilters(Store.state.items.filter(i => i.name.toLowerCase().includes(query.toLowerCase())));
        res.innerHTML = filtered.map(item => CardComponent(item)).join('');
    },

    modal(show, content) {
        let modal = document.getElementById('modal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'modal';
            modal.className = 'modal-wrap';
            document.body.appendChild(modal);
        }
        if (show) {
            modal.innerHTML = `<div class="modal-body pad">${content}</div>`;
            modal.style.display = 'flex';
        } else {
            modal.style.display = 'none';
        }
    }
};

// --- 7. INITIALIZATION ---

function attachGlobalListeners() {
    // Attach if needed
}

// Boot
Store.init();
if (Store.state.user) {
    Router.navigate('home');
} else {
    Router.navigate('auth');
}

</script>
</body>
</html>
