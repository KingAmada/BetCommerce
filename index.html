<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>WinBeta | The Super App</title>
<link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* --- ROOT VARIABLES --- */
    :root {
        --bg: #020617;
        --surface: #0f172a;
        --surface-2: #1e293b;
        --border: #334155;
        --primary: #10B981;
        --primary-dim: rgba(16, 185, 129, 0.1);
        --accent: #F59E0B;
        --danger: #EF4444;
        --info: #3B82F6;
        --text: #F8FAFC;
        --text-muted: #94A3B8;
        --nav-height: 72px;
        --header-height: 60px;
        --ease: cubic-bezier(0.23, 1, 0.32, 1);
        --shadow-lg: 0 10px 15px rgba(0,0,0,0.2);
        --gradient-primary: linear-gradient(to right, var(--primary), var(--info));
    }

    /* --- RESET & BASE --- */
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; width: 100vw; line-height: 1.5; }
    h1, h2, h3, .brand { font-family: 'Clash Display', sans-serif; font-weight: 700; }
    button { cursor: pointer; font-family: inherit; }
    input, select { font-family: inherit; }

    /* --- UTILITIES --- */
    .flex-between { display: flex; align-items: center; justify-content: space-between; }
    .flex-center { display: flex; align-items: center; justify-content: center; }
    .text-gradient { background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .text-muted { color: var(--text-muted); }
    .scroll-y { overflow-y: auto; height: 100%; padding-bottom: 100px; scroll-behavior: smooth; }
    .pad { padding: 20px; }
    .hidden { display: none !important; }

    /* --- COMPONENTS --- */
    /* Buttons */
    .btn { width: 100%; padding: 16px; border-radius: 14px; font-weight: 600; border: none; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn:active { transform: scale(0.96); }
    .btn-primary { background: var(--primary); color: #000; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
    .btn-icon { width: 40px; height: 40px; padding: 0; border-radius: 50%; }

    /* Inputs */
    .input-group { margin-bottom: 15px; position: relative; width: 100%; }
    .input-field { width: 100%; background: var(--surface); border: 1px solid var(--border); color: var(--text); padding: 16px; border-radius: 14px; font-size: 1rem; transition: 0.3s; }
    .input-field:focus { border-color: var(--primary); }
    .input-label { position: absolute; top: -8px; left: 12px; background: var(--bg); padding: 0 5px; font-size: 0.75rem; color: var(--text-muted); }

    /* Cards */
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; margin-bottom: 15px; position: relative; transition: transform 0.1s; }
    .card:active { transform: scale(0.98); }
    .card-img { width: 100%; height: 180px; object-fit: cover; background: var(--surface-2); }
    .tag { position: absolute; top: 10px; left: 10px; padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; }
    .tag.pool { background: var(--primary); color: #000; }
    .tag.auction { background: var(--accent); color: #000; }
    .tag.buy { background: var(--info); color: #fff; }

    /* Navigation */
    .nav-bar { height: var(--nav-height); background: var(--surface); border-top: 1px solid var(--border); position: fixed; bottom: 0; width: 100%; display: grid; grid-template-columns: repeat(5, 1fr); z-index: 100; padding-bottom: env(safe-area-inset-bottom); }
    .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-muted); transition: 0.3s; }
    .nav-item.active { color: var(--primary); }
    .nav-item i { font-size: 1.4rem; margin-bottom: 4px; }
    .nav-fab { background: var(--text); color: var(--bg); width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-top: -25px; box-shadow: 0 8px 20px rgba(255,255,255,0.15); font-size: 1.5rem; }

    /* Layout & Views */
    #app-root { width: 100%; height: 100%; position: relative; }
    .view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 10; display: none; flex-direction: column; }
    .view.active { display: flex; animation: fadeUp 0.3s var(--ease); }
    .view.overlay { z-index: 50; animation: slideIn 0.3s var(--ease); }
    
    header { height: var(--header-height); border-bottom: 1px solid var(--border); background: rgba(2,6,23,0.9); backdrop-filter: blur(12px); position: sticky; top: 0; z-index: 40; }

    /* Wallet & Profile */
    .balance-card { background: linear-gradient(135deg, var(--surface-2), #0f172a); padding: 25px; border-radius: 20px; border: 1px solid var(--border); text-align: center; margin-bottom: 20px; position: relative; overflow: hidden; }
    .balance-card::before { content:''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 60%); pointer-events: none; }
    .tx-row { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
    .tx-icon { width: 40px; height: 40px; border-radius: 10px; background: var(--surface-2); display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 1.2rem; }
    
    .avatar-lg { width: 100px; height: 100px; border-radius: 50%; background: var(--surface-2); margin: 0 auto 15px; border: 2px solid var(--primary); object-fit: cover; display: block; }
    .stat-row { display: flex; justify-content: space-around; margin-bottom: 20px; }
    .stat-box { text-align: center; background: var(--surface); padding: 15px; border-radius: 12px; width: 30%; border: 1px solid var(--border); }

    /* Ticker */
    .ticker-wrap { background: var(--primary); height: 30px; display: flex; align-items: center; overflow: hidden; }
    .ticker { animation: ticker 20s linear infinite; white-space: nowrap; display: flex; }
    .ticker-item { color: #000; font-weight: 700; font-size: 0.8rem; margin-right: 30px; }

    /* Modals & Toasts */
    .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 200; display: none; justify-content: center; align-items: flex-end; backdrop-filter: blur(4px); opacity: 0; transition: opacity 0.3s; }
    .modal-backdrop.show { display: flex; opacity: 1; }
    .modal-body { background: var(--surface-2); width: 100%; padding: 25px; border-radius: 25px 25px 0 0; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); border-top: 1px solid var(--border); max-height: 85vh; overflow-y: auto; }
    .modal-backdrop.show .modal-body { transform: translateY(0); }

    .toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 300; width: 90%; pointer-events: none; }
    .toast { background: var(--surface); border: 1px solid var(--primary); color: var(--text); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; animation: fadeUp 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5); pointer-events: auto; }

    /* Auth */
    .auth-container { height: 100%; display: flex; flex-direction: column; justify-content: center; padding: 30px; background: radial-gradient(circle at top right, #1e293b 0%, #020617 60%); }

    /* Animations */
    @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div id="app-root"></div>

<!-- Modal Portal -->
<div id="modal-portal" class="modal-backdrop">
    <div class="modal-body" id="modal-content"></div>
</div>

<script>
/**
 * WinBeta Core OS (Fixed & Optimized)
 * Version: 2.1 Stable
 */

// --- 1. STATE MANAGEMENT ---
const Store = {
    state: {
        user: null,
        wallet: { balance: 0, transactions: [] },
        items: [],
        myBids: [],
        currentFilters: {},
    },
    
    init() {
        const saved = localStorage.getItem('winbeta_db_v2');
        if (saved) {
            this.state = JSON.parse(saved);
        } else {
            this.seedData();
        }
    },

    save() {
        localStorage.setItem('winbeta_db_v2', JSON.stringify(this.state));
    },

    seedData() {
        this.state.items = [
            { id: 1, type: 'pool', category: 'Electronics', name: 'iPhone 15 Pro Max', price: 1000, sold: 840, total: 1000, img: 'https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=500', seller: 'AppleStore_NG' },
            { id: 2, type: 'auction', category: 'Fashion', name: 'Rolex Submariner', price: 45000, bids: 12, img: 'https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=500', seller: 'Chief_Obi' },
            { id: 3, type: 'buy', category: 'Electronics', name: 'MacBook Air M2', price: 650000, original: 700000, img: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca4?w=500', seller: 'GadgetWorld' },
            { id: 4, type: 'pool', category: 'Auto', name: 'Toyota Camry 2020', price: 5000, sold: 120, total: 2500, img: 'https://images.unsplash.com/photo-1621007947382-bb3c3968e3bb?w=500', seller: 'AutoHub' },
            { id: 5, type: 'buy', category: 'Electronics', name: 'Samsung Galaxy S23', price: 400000, img: 'https://images.unsplash.com/photo-1671113790943-0e4586e14d2f?w=500', seller: 'TechHub' },
            { id: 6, type: 'auction', category: 'Auto', name: 'Honda Accord 2018', price: 30000, bids: 5, img: 'https://images.unsplash.com/photo-1550355295-bbee04a4b5d0?w=500', seller: 'CarDealer' },
        ];
        this.state.wallet.balance = 2500;
        this.save();
    },

    applyFilters(items) {
        let filtered = items;
        const f = this.state.currentFilters;
        if (f.category && f.category !== 'All') filtered = filtered.filter(i => i.category === f.category);
        if (f.type && f.type !== 'All') filtered = filtered.filter(i => i.type === f.type);
        return filtered;
    }
};

// --- 2. ROUTER ENGINE ---
const Router = {
    routes: {
        'auth': renderAuth,
        'home': renderHome,
        'search': renderSearch,
        'sell': renderSell,
        'wallet': renderWallet,
        'profile': renderProfile,
        'product': renderProduct
    },
    history: [],

    navigate(route, params = null) {
        const viewName = route.split('/')[0];
        this.history.push({ route, params });
        
        // Hide all views
        document.querySelectorAll('.view').forEach(el => {
            if(!el.classList.contains('overlay')) el.classList.remove('active');
        });
        
        // Remove existing overlays if navigating to a base route
        if(viewName !== 'product') {
             document.querySelectorAll('.view.overlay').forEach(el => el.remove());
        }

        let viewEl = document.getElementById(`view-${viewName}`);
        
        // Render logic
        if (!viewEl || viewName === 'product') { // Always re-render product for params
            // If it's a product (overlay), create a new one, otherwise reuse/create base view
            if(viewName === 'product') {
                viewEl = document.createElement('div');
                viewEl.className = 'view overlay';
            } else if(!viewEl) {
                viewEl = document.createElement('div');
                viewEl.id = `view-${viewName}`;
                viewEl.className = 'view';
                document.getElementById('app-root').appendChild(viewEl);
            }
            
            // Generate Content
            if (this.routes[viewName]) {
                viewEl.innerHTML = this.routes[viewName](params);
                if(viewName === 'product') document.getElementById('app-root').appendChild(viewEl);
            }
        } else {
            // Refresh content for home/wallet to update state
            if(['home', 'wallet', 'profile'].includes(viewName)) {
                 viewEl.innerHTML = this.routes[viewName](params);
            }
        }
        
        // Activate
        setTimeout(() => viewEl.classList.add('active'), 10);
        updateNav(viewName);
    },

    back() {
        if (this.history.length > 1) {
            this.history.pop();
            const prev = this.history[this.history.length - 1];
            // If we are going back from an overlay, remove the top overlay
            const overlays = document.querySelectorAll('.view.overlay');
            if(overlays.length > 0) {
                const top = overlays[overlays.length-1];
                top.classList.remove('active');
                setTimeout(() => top.remove(), 300);
                updateNav(prev.route);
            } else {
                this.navigate(prev.route, prev.params);
            }
        }
    }
};

function updateNav(viewName) {
    document.querySelectorAll('.nav-item').forEach(el => {
        el.classList.remove('active');
        // Crude matching for nav highlighting
        if(el.getAttribute('onclick') && el.getAttribute('onclick').includes(`'${viewName}'`)) {
            el.classList.add('active');
        }
    });
}

// --- 3. VIEW RENDERERS ---

function renderAuth() {
    return `
        <div class="auth-container">
            <h1 class="brand" style="font-size: 2.5rem; margin-bottom: 10px;">Win<span class="text-gradient">Beta</span></h1>
            <p class="text-muted" style="margin-bottom: 40px;">The future of social commerce.</p>
            
            <div class="input-group">
                <label class="input-label">Email Address</label>
                <input type="email" id="login-email" class="input-field" placeholder="you@example.com">
            </div>
            
            <button class="btn btn-primary" onclick="Auth.login()">
                Sign In <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>
    `;
}

function renderHome() {
    const filteredItems = Store.applyFilters(Store.state.items);
    const itemsHtml = filteredItems.map(item => CardComponent(item)).join('');
    
    return `
        ${TickerComponent()}
        ${HeaderComponent()}
        <div class="scroll-y">
            <div class="pad">
                <div class="flex-between" style="margin-bottom: 15px;">
                    <h2>Trending ðŸ”¥</h2>
                    <button class="btn btn-outline" style="width: auto; padding: 8px 12px;" onclick="UI.showFilterModal()">
                        <i class="fa-solid fa-filter"></i> Filter
                    </button>
                </div>
                ${itemsHtml.length ? itemsHtml : '<p class="text-muted text-center">No items found matching filters.</p>'}
            </div>
        </div>
        ${NavComponent('home')}
    `;
}

function renderSearch() {
    return `
        <div style="padding: 15px 20px; border-bottom:1px solid var(--border);">
            <div class="input-group" style="margin:0;">
                <i class="fa-solid fa-search" style="position:absolute; top:18px; left:15px; color:var(--text-muted)"></i>
                <input type="text" class="input-field" style="padding-left:40px;" placeholder="Search items..." onkeyup="UI.search(this.value)">
            </div>
        </div>
        <div class="scroll-y pad" id="search-results">
            <div class="text-muted" style="text-align:center; margin-top:50px;">
                <i class="fa-solid fa-compass" style="font-size:3rem; margin-bottom:15px; opacity:0.3;"></i>
                <p>Start typing to explore...</p>
            </div>
        </div>
        ${NavComponent('search')}
    `;
}

function renderSell() {
    return `
        <div class="pad scroll-y">
            <h2 class="brand" style="margin-bottom:20px;">List Item ðŸ“¦</h2>
            <div class="card" style="padding:20px;">
                <div class="input-group">
                    <label class="input-label">Item Name</label>
                    <input id="sell-name" type="text" class="input-field">
                </div>
                 <div class="input-group">
                    <label class="input-label">Type</label>
                    <select id="sell-type" class="input-field">
                        <option value="pool">Pool Ticket</option>
                        <option value="auction">Auction</option>
                        <option value="buy">Direct Sale</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Price / Start Bid</label>
                    <input id="sell-price" type="number" class="input-field">
                </div>
                
                <div style="border:2px dashed var(--border); padding:30px; text-align:center; border-radius:12px; margin-bottom:20px;" onclick="UI.toast('Image upload simulated', 'success')">
                    <i class="fa-solid fa-camera" style="font-size:2rem; color:var(--text-muted)"></i>
                </div>

                <button class="btn btn-primary" onclick="Actions.listItem()">Post Listing</button>
            </div>
        </div>
        ${NavComponent('sell')}
    `;
}

function renderWallet() {
    const txHtml = Store.state.wallet.transactions.length ? 
        Store.state.wallet.transactions.slice().reverse().map(tx => `
            <div class="tx-row">
                <div class="tx-icon"><i class="fa-solid ${tx.type === 'credit' ? 'fa-arrow-down' : 'fa-arrow-up'}" style="color: ${tx.type === 'credit' ? 'var(--primary)' : 'var(--text)'}"></i></div>
                <div style="flex:1;">
                    <div style="font-weight:600;">${tx.desc}</div>
                    <div style="font-size:0.75rem; color:var(--text-muted);">${new Date(tx.date).toLocaleTimeString()}</div>
                </div>
                <div style="font-weight:700; color:${tx.type === 'credit' ? 'var(--primary)' : 'var(--text)'}">
                    ${tx.type === 'credit' ? '+' : '-'}â‚¦${tx.amount.toLocaleString()}
                </div>
            </div>
        `).join('') : '<p class="text-muted" style="text-align:center; padding:20px;">No transactions yet.</p>';

    return `
        <div class="pad scroll-y">
            <h2 class="brand" style="margin-bottom:20px;">Wallet</h2>
            <div class="balance-card">
                <div style="font-size:0.9rem; color:var(--text-muted); margin-bottom:5px;">Total Balance</div>
                <h1 style="font-size:2.5rem; margin-bottom:20px;">â‚¦${Store.state.wallet.balance.toLocaleString()}</h1>
                <div class="flex-center" style="gap:10px;">
                    <button class="btn btn-primary" style="padding:10px; width:auto; flex:1;" onclick="Actions.deposit()">Deposit</button>
                    <button class="btn btn-outline" style="padding:10px; width:auto; flex:1;">Withdraw</button>
                </div>
            </div>

            <div style="background: linear-gradient(45deg, #7c3aed, #db2777); padding:15px; border-radius:12px; margin-bottom:25px; display:flex; justify-content:space-between; align-items:center; color:white;">
                <div>
                    <div style="font-weight:700;">Daily Reward</div>
                    <div style="font-size:0.8rem; opacity:0.9;">Spin to win free credits!</div>
                </div>
                <button class="btn" style="background:white; color:#db2777; width:auto; padding:8px 15px; border-radius:20px; font-size:0.8rem;" onclick="Actions.dailySpin()">Spin</button>
            </div>

            <h3 style="margin-bottom:15px;">History</h3>
            <div>${txHtml}</div>
        </div>
        ${NavComponent('wallet')}
    `;
}

function renderProfile() {
    const user = Store.state.user || {name: 'Guest', email: 'guest@winbeta.app'};
    return `
        <div class="pad scroll-y">
            <div style="display:flex; justify-content:flex-end;"><i class="fa-solid fa-gear" style="font-size:1.2rem;"></i></div>
            <div style="text-align:center; padding: 20px 0;">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${user.email}" class="avatar-lg">
                <h2>${user.name}</h2>
                <p class="text-muted">@${user.username || 'user'}</p>
            </div>
            
            <div class="stat-row">
                <div class="stat-box"><h3>${Store.state.myBids.length}</h3><span class="text-muted" style="font-size:0.8rem">Orders</span></div>
                <div class="stat-box"><h3>0</h3><span class="text-muted" style="font-size:0.8rem">Won</span></div>
                <div class="stat-box"><h3>0</h3><span class="text-muted" style="font-size:0.8rem">Listed</span></div>
            </div>

            <div class="card">
                <div class="tx-row" style="padding:20px; border-bottom:1px solid var(--border);" onclick="UI.toast('Coming soon', 'info')">
                    <i class="fa-regular fa-heart" style="margin-right:15px; color:var(--accent)"></i> Favorites
                </div>
                <div class="tx-row" style="padding:20px; border-bottom:1px solid var(--border);" onclick="UI.toast('No notifications', 'info')">
                    <i class="fa-regular fa-bell" style="margin-right:15px; color:var(--info)"></i> Notifications
                </div>
                 <div class="tx-row" style="padding:20px;" onclick="Auth.logout()">
                    <i class="fa-solid fa-arrow-right-from-bracket" style="margin-right:15px; color:var(--danger)"></i> Logout
                </div>
            </div>
        </div>
        ${NavComponent('profile')}
    `;
}

function renderProduct(id) {
    const item = Store.state.items.find(i => i.id == id);
    if(!item) return `<div class="pad">Item not found</div>`;

    let actionArea = '';
    if (item.type === 'pool') {
        actionArea = `<div class="flex-between" style="gap:10px; margin-top:20px;">
            <button class="btn btn-outline" onclick="Actions.buyTicket(${item.id}, 1)">1 Tix (â‚¦${item.price})</button>
            <button class="btn btn-primary" onclick="Actions.buyTicket(${item.id}, 5)">5 Tix (â‚¦${item.price*5})</button>
        </div>`;
    } else if (item.type === 'auction') {
         actionArea = `<div style="margin-top:20px;">
            <div class="input-group"><input id="bid-val" type="number" class="input-field" value="${item.price + 1000}"></div>
            <button class="btn" style="background:var(--accent); color:black;" onclick="Actions.placeBid(${item.id})">Place Bid</button>
        </div>`;
    } else {
        actionArea = `<button class="btn btn-primary" style="margin-top:20px;" onclick="Actions.buyTicket(${item.id}, 1)">Buy Now</button>`;
    }

    return `
        <div style="position:absolute; top:20px; left:20px; z-index:100;">
            <button onclick="Router.back()" style="background:rgba(0,0,0,0.5); border:none; color:white; width:40px; height:40px; border-radius:50%; backdrop-filter:blur(5px);"><i class="fa-solid fa-arrow-left"></i></button>
        </div>
        <img src="${item.img}" style="width:100%; height:40vh; object-fit:cover;">
        <div class="pad" style="background:var(--bg); flex:1; border-radius:30px 30px 0 0; margin-top:-30px; position:relative; z-index:10; overflow-y:auto;">
            <div class="flex-between">
                <div class="tag ${item.type}">${item.type.toUpperCase()}</div>
                <div class="text-muted"><i class="fa-solid fa-eye"></i> 24 viewing</div>
            </div>
            <h1 style="margin:15px 0; line-height:1.2;">${item.name}</h1>
            <h2 class="text-gradient">â‚¦${item.price.toLocaleString()}</h2>
            
            <div style="margin:20px 0; padding:15px; background:var(--surface); border-radius:12px; display:flex; align-items:center; gap:15px;">
                <div style="width:40px; height:40px; background:var(--border); border-radius:50%; display:flex; align-items:center; justify-content:center;"><i class="fa-solid fa-store"></i></div>
                <div>
                    <div style="font-weight:700;">${item.seller} <i class="fa-solid fa-check-circle" style="color:var(--info); font-size:0.8rem;"></i></div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">Verified Merchant</div>
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px;">
                 <div class="card" style="padding:15px; text-align:center; margin:0;">
                    <div class="text-muted" style="font-size:0.8rem;">Category</div>
                    <div style="font-weight:600;">${item.category}</div>
                 </div>
                 <div class="card" style="padding:15px; text-align:center; margin:0;">
                    <div class="text-muted" style="font-size:0.8rem;">Condition</div>
                    <div style="font-weight:600;">Brand New</div>
                 </div>
            </div>

            <p style="line-height:1.6; color:var(--text-muted);">
                This ${item.name} is available for immediate delivery. Secure transaction guaranteed by WinBeta Escrow.
            </p>
            
            ${actionArea}
            <div style="height:50px;"></div>
        </div>
    `;
}

// --- 4. COMPONENT FACTORIES ---

function CardComponent(item) {
    const sub = item.type === 'pool' ? `${item.sold}/${item.total} sold` : item.type === 'auction' ? `${item.bids} bids` : 'Direct Sale';
    return `
        <div class="card" onclick="Router.navigate('product', ${item.id})">
            <div class="tag ${item.type}">${item.type}</div>
            <img src="${item.img}" class="card-img">
            <div style="padding:15px;">
                <div style="font-weight:600; margin-bottom:5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${item.name}</div>
                <div class="flex-between">
                    <div style="font-weight:700;">â‚¦${item.price.toLocaleString()}</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">${sub}</div>
                </div>
            </div>
        </div>
    `;
}

function NavComponent(active) {
    const links = [
        { id: 'home', icon: 'fa-house', label: 'Home' },
        { id: 'search', icon: 'fa-magnifying-glass', label: 'Search' },
        { id: 'sell', icon: 'fa-plus', fab: true },
        { id: 'wallet', icon: 'fa-wallet', label: 'Wallet' },
        { id: 'profile', icon: 'fa-user', label: 'Account' }
    ];
    
    const html = links.map(l => {
        if(l.fab) return `<div class="nav-item" onclick="Router.navigate('${l.id}')"><div class="nav-fab"><i class="fa-solid ${l.icon}"></i></div></div>`;
        return `<div class="nav-item ${active===l.id?'active':''}" onclick="Router.navigate('${l.id}')">
            <i class="fa-solid ${l.icon}"></i> <span style="font-size:0.7rem;">${l.label}</span>
        </div>`;
    }).join('');
    
    return `<nav class="nav-bar">${html}</nav>`;
}

function HeaderComponent() {
    return `<header class="flex-between pad">
        <div class="brand" style="font-size:1.2rem;">Win<span class="text-gradient">Beta</span></div>
        <div class="flex-center" style="gap:15px;">
            <i class="fa-regular fa-bell" style="font-size:1.2rem;"></i>
            <div onclick="Router.navigate('wallet')" style="background:var(--surface-2); padding:5px 12px; border-radius:20px; font-size:0.8rem; font-weight:700; border:1px solid var(--border);">
                â‚¦${Store.state.wallet.balance.toLocaleString()}
            </div>
        </div>
    </header>`;
}

function TickerComponent() {
    return `<div class="ticker-wrap"><div class="ticker">
        <div class="ticker-item">ðŸ”¥ Emeka just won iPhone 15</div>
        <div class="ticker-item">ðŸ’° New Bid on PS5: â‚¦120,000</div>
        <div class="ticker-item">ðŸš€ WinBeta 2.0 is Live!</div>
        <div class="ticker-item">ðŸ”¥ Sarah sold her Car for â‚¦2.5M</div>
    </div></div>`;
}

// --- 5. LOGIC ACTIONS ---

const Auth = {
    login() {
        const email = document.getElementById('login-email').value;
        if (!email) return UI.toast('Enter email address', 'error');
        
        UI.loader(true);
        setTimeout(() => {
            Store.state.user = { name: 'WinBeta User', email: email, username: email.split('@')[0] };
            Store.save();
            UI.loader(false);
            Router.navigate('home');
            UI.toast('Welcome back!', 'success');
        }, 1000);
    },
    logout() {
        Store.state.user = null;
        Store.save();
        Router.navigate('auth');
    }
};

const Actions = {
    deposit() {
        const amt = 50000;
        Store.state.wallet.balance += amt;
        Store.state.wallet.transactions.push({ type: 'credit', amount: amt, desc: 'Bank Transfer', date: Date.now() });
        Store.save();
        Router.navigate('wallet');
        UI.confetti();
        UI.toast('Funds added successfully', 'success');
    },
    
    buyTicket(id, qty) {
        const item = Store.state.items.find(i => i.id == id);
        const cost = item.price * qty;
        
        if(Store.state.wallet.balance < cost) return UI.toast('Insufficient funds', 'error');
        
        Store.state.wallet.balance -= cost;
        Store.state.wallet.transactions.push({ type: 'debit', amount: cost, desc: `Pool: ${item.name}`, date: Date.now() });
        if(item.type === 'pool') item.sold += qty;
        Store.state.myBids.push({ itemId: id, type: item.type, qty });
        Store.save();
        
        Router.navigate('wallet');
        UI.confetti();
        UI.toast(`Purchase successful!`, 'success');
    },

    placeBid(id) {
        const val = parseInt(document.getElementById('bid-val').value);
        const item = Store.state.items.find(i => i.id == id);
        
        if (val <= item.price) return UI.toast('Bid must be higher', 'error');
        if (Store.state.wallet.balance < val) return UI.toast('Insufficient wallet balance', 'error');

        item.price = val;
        item.bids++;
        Store.state.myBids.push({ itemId: id, type: 'auction', val });
        Store.save();

        Router.navigate('home'); // Go back to update price on grid
        UI.confetti();
        UI.toast('Bid placed successfully!', 'success');
    },

    listItem() {
        const name = document.getElementById('sell-name').value;
        const price = parseInt(document.getElementById('sell-price').value);
        const type = document.getElementById('sell-type').value;

        if(!name || !price) return UI.toast('Please fill all fields', 'error');

        const newItem = {
            id: Date.now(),
            name, price, type, category: 'General',
            img: 'https://images.unsplash.com/photo-1550009158-9ebf69173e03?w=500',
            seller: Store.state.user.username,
            sold: 0, total: 100, bids: 0
        };
        
        Store.state.items.unshift(newItem);
        Store.save();
        
        Router.navigate('home');
        UI.toast('Item Listed Live!', 'success');
    },

    dailySpin() {
        const win = Math.floor(Math.random() * 5000) + 100;
        Store.state.wallet.balance += win;
        Store.state.wallet.transactions.push({ type: 'credit', amount: win, desc: 'Daily Spin Reward', date: Date.now() });
        Store.save();
        Router.navigate('wallet');
        UI.confetti();
        UI.toast(`You won â‚¦${win.toLocaleString()}!`, 'success');
    }
};

// --- 6. UI MANAGER ---

const UI = {
    toast(msg, type='info') {
        const div = document.createElement('div');
        div.className = 'toast';
        div.innerHTML = `<i class="fa-solid fa-circle-info" style="color:${type==='error'?'var(--danger)':'var(--primary)'}"></i> <div>${msg}</div>`;
        
        let container = document.querySelector('.toast-container');
        if(!container) {
            container = document.createElement('div');
            container.className = 'toast-container';
            document.body.appendChild(container);
        }
        container.appendChild(div);
        setTimeout(() => {
            div.style.opacity = '0';
            setTimeout(() => div.remove(), 300);
        }, 3000);
    },

    modal(show, contentHTML = '') {
        const p = document.getElementById('modal-portal');
        const c = document.getElementById('modal-content');
        
        if(show) {
            c.innerHTML = contentHTML;
            p.classList.add('show');
            // Close on background click
            p.onclick = (e) => { if(e.target === p) UI.modal(false); };
        } else {
            p.classList.remove('show');
        }
    },

    showFilterModal() {
        const html = `
            <h3 style="margin-bottom:15px;">Filter Items</h3>
            <div class="input-group">
                <label class="input-label">Category</label>
                <select id="filter-cat" class="input-field">
                    <option value="All">All Categories</option>
                    <option value="Electronics">Electronics</option>
                    <option value="Auto">Automobiles</option>
                    <option value="Fashion">Fashion</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">Type</label>
                <select id="filter-type" class="input-field">
                    <option value="All">All Types</option>
                    <option value="pool">Pool Tickets</option>
                    <option value="auction">Auctions</option>
                    <option value="buy">Direct Buy</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="UI.applyFilterLogic()">Apply Filters</button>
        `;
        this.modal(true, html);
    },

    applyFilterLogic() {
        const cat = document.getElementById('filter-cat').value;
        const type = document.getElementById('filter-type').value;
        Store.state.currentFilters = { category: cat, type: type };
        Store.save();
        this.modal(false);
        Router.navigate('home');
    },

    loader(show) {
        if(show) {
            const l = document.createElement('div');
            l.id = 'g-loader';
            l.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.9);z-index:999;display:flex;justify-content: center;align-items: center;flex-direction: column;';
            l.innerHTML = '<div style="width:40px;height:40px;border:4px solid var(--surface-2);border-top:4px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;"></div><div style="margin-top:10px;">Processing...</div>';
            document.body.appendChild(l);
        } else {
            const l = document.getElementById('g-loader');
            if(l) l.remove();
        }
    },

    confetti() {
        const c = document.createElement('canvas');
        c.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;';
        document.body.appendChild(c);
        const ctx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        
        let particles = Array.from({length:80}).map(() => ({
            x: c.width/2, y: c.height/2,
            vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15,
            color: `hsl(${Math.random()*360},100%,50%)`, life: 100
        }));

        function loop() {
            ctx.clearRect(0,0,c.width,c.height);
            particles.forEach((p,i) => {
                p.x+=p.vx; p.y+=p.vy; p.vy+=0.5; p.life--;
                ctx.fillStyle = p.color; ctx.fillRect(p.x,p.y,6,6);
                if(p.life<=0) particles.splice(i,1);
            });
            if(particles.length) requestAnimationFrame(loop);
            else c.remove();
        }
        loop();
    },

    search(query) {
        const res = document.getElementById('search-results');
        if (!query) {
            res.innerHTML = '<div class="text-muted" style="text-align:center; margin-top:50px;"><i class="fa-solid fa-compass" style="font-size:3rem; margin-bottom:15px; opacity:0.3;"></i><p>Start typing to explore...</p></div>';
            return;
        }
        const hits = Store.state.items.filter(i => i.name.toLowerCase().includes(query.toLowerCase()));
        res.innerHTML = hits.length ? hits.map(h => `
            <div class="card" style="padding:10px; display:flex; align-items:center; gap:15px;" onclick="Router.navigate('product', ${h.id})">
                <img src="${h.img}" style="width:60px; height:60px; border-radius:8px; object-fit:cover;">
                <div>
                    <div style="font-weight:600;">${h.name}</div>
                    <div class="text-muted">â‚¦${h.price.toLocaleString()}</div>
                </div>
            </div>
        `).join('') : '<p class="pad text-muted">No results found.</p>';
    }
};

// --- 7. BOOTSTRAP ---
Store.init();

// Routing check
if (Store.state.user) {
    Router.navigate('home');
} else {
    Router.navigate('auth');
}

</script>
</body>
</html>

